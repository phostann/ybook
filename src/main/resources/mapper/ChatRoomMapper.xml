<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.ybook.mapper.ChatRoomMapper">

    <!-- 聊天室实体结果映射 -->
    <resultMap id="chatRoomResultMap" type="com.example.ybook.entity.ChatRoomEntity">
        <id column="id" property="id"/>
        <result column="room_name" property="roomName"/>
        <result column="room_type" property="roomType"/>
        <result column="room_avatar" property="roomAvatar"/>
        <result column="room_description" property="roomDescription"/>
        <result column="creator_id" property="creatorId"/>
        <result column="last_message_id" property="lastMessageId"/>
        <result column="last_message_time" property="lastMessageTime"/>
        <result column="member_count" property="memberCount"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <!-- 基础查询SQL片段 -->
    <sql id="baseColumnList">
        id, room_name, room_type, room_avatar, room_description, creator_id, 
        last_message_id, last_message_time, member_count, status, create_time, update_time
    </sql>

    <!-- 根据用户ID查询聊天室列表 -->
    <select id="selectRoomsByUserId" resultMap="chatRoomResultMap">
        SELECT cr.*
        FROM y_chat_room cr
        INNER JOIN y_chat_room_member crm ON cr.id = crm.room_id
        WHERE crm.user_id = #{userId} AND crm.status = 'ACTIVE'
        ORDER BY cr.last_message_time DESC
    </select>

</mapper>